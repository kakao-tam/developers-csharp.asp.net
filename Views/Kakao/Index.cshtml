@{
    ViewData["Title"] = "Kakao REST-API C#.asp.net example";
}

<div class="header">
    <h1>카카오 로그인 및 API 예제</h1>
</div>

<div class="main-container">
    <div class="notice">
        <h3>설정 안내</h3>
        <pre>
- [KOE101, KOE004] 내 애플리케이션>제품 설정>카카오 로그인 > 활성화 설정 : ON
- [KOE006] 내 애플리케이션>제품 설정>카카오 로그인 > Redirect URI : <span id="redirectUri"></span></pre>
    </div>

    <div class="container">
        <div class="vertical-layout">
            <script>
                // 현재 도메인 가져오기
                const currentDomain = window.location.origin;
                const redirectUri = currentDomain + '/api/kakao/redirect';
                document.getElementById('redirectUri').textContent = redirectUri;

                Kakao.init("  this is javascript key "); // 여기에 JavaScript 키를 입력하세요

                function kakaoLogin() {
                    Kakao.Auth.authorize({
                        redirectUri: redirectUri,
                    });
                }

                async function REST_Call(path) {
                    try {
                        const response = await axios.get("/api/kakao" + path);
                        console.log(response.data);
                        document.getElementById("contents").value = JSON.stringify(
                            response.data,
                            null,
                            2
                        );
                    } catch (error) {
                        console.error(error);
                        document.getElementById("contents").value = JSON.stringify(
                            error.response ? error.response.data : error,
                            null,
                            2
                        );
                    }
                }
            </script>

            <div class="login-container">
                <div class="login-buttons">
                    <a href="/api/kakao/authorize">
                        <img src="//k.kakaocdn.net/14/dn/btqCn0WEmI3/nijroPfbpCa4at5EIsjyf0/o.jpg" alt="카카오 로그인" />
                    </a>
                    <button onclick="kakaoLogin()" style="background-color: white; border: 1px solid var(--kakao-yellow);">
                        JavaScript SDK로 로그인
                    </button>
                </div>
            </div>

            <div class="api-container">
                <div class="section-title">기본 기능</div>
                <div class="button-group">
                    <button onclick="REST_Call('/profile')">프로필 조회</button>
                    <button onclick="REST_Call('/logout')" style="background-color: white; border: 1px solid #e5e5e5">
                        로그아웃
                    </button>
                    <button onclick="REST_Call('/unlink')" style="background-color: white; color: #ff5c5c; border: 1px solid #ff5c5c">
                        연결끊기
                    </button>
                </div>
            </div>

            <textarea id="contents" placeholder="API 응답 결과가 여기에 표시됩니다..."></textarea>

            <div class="api-container">
                <div class="section-title">추가 기능</div>
                <div class="button-group">
                    <a href="/api/kakao/authorize?scope=friends,talk_message">
                        <button style="background-color: white; border: 1px solid var(--kakao-yellow)">
                            친구목록/메시지 권한 획득
                        </button>
                    </a>
                    <button onclick="REST_Call('/friends')">친구목록 조회</button>
                    <button onclick="REST_Call('/message')">나에게 메시지 발송</button>
                    <div class="friend-message-container">
                        <input type="text" id="friend-uuid" placeholder='UUID 입력 ex) "AAA","BBB" 쌍따옴표 포함' />
                        <button onclick="REST_Call('/friend-message?uuid=' + document.getElementById('friend-uuid').value)">
                            친구에게 메시지 발송
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div> 